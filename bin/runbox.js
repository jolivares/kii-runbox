// Generated by CoffeeScript 1.6.3
var execCommand, express, fs, loadFile, open, port, program, runServer;

fs = require('fs');

open = require('open');

express = require('express');

program = require('commander');

port = 1337;

exports.execCommand = function() {
  return execCommand();
};

execCommand = function() {
  program.option('--script <script>', 'Full path to server code script.').option('--config <config>', 'Execution context config.');
  program.parse(process.argv);
  if (!fs.existsSync(program.script)) {
    console.log("Not found script file " + program.script);
    process.exit(1);
  }
  if (!fs.existsSync(program.config)) {
    console.log("Not found config file " + program.config);
    process.exit(1);
  }
  return runServer(program.script, program.config);
};

runServer = function(scriptPath, configPath) {
  var app, url;
  app = express();
  app.use(express["static"](__dirname + "/.."));
  app.get('/developer.code.js', function(req, res) {
    res.setHeader('Content-Type', 'application/javascript');
    return res.end(loadFile(scriptPath));
  });
  app.get('/runbox.stub.config.js', function(req, res) {
    res.setHeader('Content-Type', 'application/javascript');
    return res.end(loadFile(configPath));
  });
  app.listen(port);
  url = "http://127.0.0.1:" + port + "/runbox.html";
  console.log("Server running at " + url);
  return open(url);
};

loadFile = function(path) {
  return fs.readFileSync(path, 'utf8');
};
